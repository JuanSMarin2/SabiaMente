<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Introduce el código — SabiaMente</title>
  <link rel="icon" type="image/svg+xml" href="vite.svg" />
  <link rel="stylesheet" href="styles/ui.css" />
  <style>
    .subtitle { color: var(--muted); text-align:center; margin: 0 0 18px; }
    .code { display:flex; gap:10px; justify-content:center; margin: 12px 0 6px; }
    .code input {
      width: 52px; height: 58px; text-align:center; font-size: 24px; font-weight: 700;
      border:1.6px solid #d7dce3; border-radius: 12px; outline:none; box-shadow: 0 2px 6px rgba(0,0,0,.05);
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    .code input:focus { border-color:#94a3b8; box-shadow: 0 0 0 3px rgba(148,163,184,.25); }
    .link.center { display:block; text-align:center; margin:6px 0 14px; }
    .btn:disabled { opacity:.55; cursor:not-allowed; }
  </style>
</head>
<body>
  <div class="page">
    <main class="card narrow">
      <h1 class="title center">Introduce el código</h1>
      <p id="sentTo" class="subtitle">Se ha enviado un código al correo: —</p>

      <div class="code" id="codeBox">
        <input inputmode="numeric" maxlength="1" />
        <input inputmode="numeric" maxlength="1" />
        <input inputmode="numeric" maxlength="1" />
        <input inputmode="numeric" maxlength="1" />
      </div>

      <a href="#" id="resend" class="link center">No recibí el código</a>

      <button id="continueBtn" class="btn primary" disabled>Continuar</button>
    </main>
  </div>

  <script>
    // Mostrar destino enmascarado
    const masked = localStorage.getItem("recover_masked") || "tu contacto";
    document.getElementById("sentTo").textContent = `Se ha enviado un código al correo: ${masked}`;

    const inputs = Array.from(document.querySelectorAll("#codeBox input"));
    const btn = document.getElementById("continueBtn");

    // Auto-avance y pegado
    inputs.forEach((inp, idx) => {
      inp.addEventListener("input", (e) => {
        e.target.value = e.target.value.replace(/\D/g, "").slice(0,1);
        if (e.target.value && idx < inputs.length - 1) inputs[idx+1].focus();
        validate();
      });
      inp.addEventListener("keydown", (e) => {
        if (e.key === "Backspace" && !e.target.value && idx > 0) inputs[idx-1].focus();
      });
      inp.addEventListener("paste", (e) => {
        e.preventDefault();
        const text = (e.clipboardData || window.clipboardData).getData("text").replace(/\D/g,"").slice(0,inputs.length);
        text.split("").forEach((ch,i)=>{ inputs[i].value = ch; });
        const next = Math.min(text.length, inputs.length-1);
        inputs[next].focus();
        validate();
      });
    });

    function validate(){
      const code = inputs.map(i=>i.value).join("");
      btn.disabled = code.length !== inputs.length;
    }

    document.getElementById("resend").addEventListener("click", (e)=>{
      e.preventDefault();
      alert("Se ha reenviado el código a " + masked);
    });

    btn.addEventListener("click", ()=>{
      const code = inputs.map(i=>i.value).join("");
      if (code.length === inputs.length){
        // Aquí harías la verificación real; por ahora redirigimos al login o cambio de contraseña
        window.location.href = "mainMenu";
      }
    });
  </script>
</body>
</html>
